<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Taaruf App - Deployment Guide</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <span class="logo-icon">üöÄ</span>
          <span class="logo-text">Deployment Guide</span>
        </div>
      </div>

      <div class="nav-section">
        <span class="nav-label">Overview</span>
        <a href="#architecture" class="nav-item">Arsitektur Sistem</a>
      </div>

      <div class="nav-section">
        <span class="nav-label">SSL & Domain</span>
        <a href="#ssl" class="nav-item">SSL Subdomain Rules</a>
        <a href="#cloudflared" class="nav-item">Update Cloudflared</a>
      </div>

      <div class="nav-section">
        <span class="nav-label">Authentication</span>
        <a href="#oauth-flow" class="nav-item">Google OAuth Flow</a>
        <a href="#oauth-setup" class="nav-item">Setup Google Console</a>
        <a href="#oauth-laravel" class="nav-item">Laravel Config</a>
      </div>

      <div class="nav-section">
        <span class="nav-label">Deployment</span>
        <a href="#deploy-steps" class="nav-item">Deployment Steps</a>
        <a href="#checklist" class="nav-item">Checklist</a>
      </div>

      <div class="nav-section">
        <span class="nav-label">Help</span>
        <a href="#troubleshooting" class="nav-item">Troubleshooting</a>
        <a href="#urls" class="nav-item">URLs Aplikasi</a>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Hero Section -->
      <section class="hero">
        <span class="hero-badge">üìö Documentation</span>
        <h1>
          Taaruf App<br /><span class="gradient-text">Deployment Guide</span>
        </h1>
        <p class="hero-subtitle">
          Panduan lengkap deployment dan troubleshooting aplikasi Taaruf
        </p>
        <div class="hero-stats">
          <div class="stat">
            <span class="stat-value">4</span>
            <span class="stat-label">Deployment Steps</span>
          </div>
          <div class="stat">
            <span class="stat-value">4</span>
            <span class="stat-label">Troubleshooting</span>
          </div>
          <div class="stat">
            <span class="stat-value">2</span>
            <span class="stat-label">Servers</span>
          </div>
        </div>
      </section>

      <!-- Architecture Section -->
      <section id="architecture" class="section">
        <div class="section-header">
          <span class="section-icon">üåê</span>
          <h2>Arsitektur Sistem</h2>
        </div>

        <div class="architecture-diagram">
          <div class="arch-node">
            <div class="arch-icon">üë§</div>
            <div class="arch-label">User Browser</div>
            <div class="arch-sublabel">HTTPS Request</div>
          </div>
          <div class="arch-arrow">‚Üí</div>
          <div class="arch-node cloudflare">
            <div class="arch-icon">‚òÅÔ∏è</div>
            <div class="arch-label">Cloudflare</div>
            <div class="arch-sublabel">SSL Termination</div>
          </div>
          <div class="arch-arrow">‚Üí</div>
          <div class="arch-node">
            <div class="arch-icon">üîí</div>
            <div class="arch-label">Cloudflared</div>
            <div class="arch-sublabel">Tunnel</div>
          </div>
          <div class="arch-arrow">‚Üí</div>
          <div class="arch-node">
            <div class="arch-icon">üñ•Ô∏è</div>
            <div class="arch-label">Ubuntu Server</div>
            <div class="arch-sublabel">192.168.13.76</div>
          </div>
        </div>

        <div class="arch-features">
          <span class="arch-feature"
            ><span class="check">‚úì</span> taaruf.donarazhar.site (Web
            React)</span
          >
          <span class="arch-feature"
            ><span class="check">‚úì</span> taaruf-api.donarazhar.site (Laravel
            API)</span
          >
        </div>
      </section>

      <!-- SSL Section -->
      <section id="ssl" class="section">
        <div class="step-header">
          <div class="step-number">‚ö†Ô∏è</div>
          <div>
            <h2>SSL Subdomain Naming Rules</h2>
            <p class="step-desc">
              Cloudflare Universal SSL hanya cover 1 level subdomain
            </p>
          </div>
        </div>

        <div class="warning-card">
          <span class="warning-icon">‚ö†Ô∏è</span>
          <div class="warning-content">
            <strong>Penting:</strong> Cloudflare Universal SSL (gratis) hanya
            mencakup <code>*.domain.com</code> (1 level), TIDAK mencakup
            <code>*.subdomain.domain.com</code> (2 level)
          </div>
        </div>

        <div class="prereq-grid" style="margin-top: 1.5rem">
          <div class="prereq-card" style="border-color: #ef4444">
            <div class="prereq-icon">‚ùå</div>
            <h3>Salah (2 Level)</h3>
            <p><code>api.taaruf.donarazhar.site</code></p>
          </div>
          <div class="prereq-card" style="border-color: #22c55e">
            <div class="prereq-icon">‚úÖ</div>
            <h3>Benar (1 Level)</h3>
            <p><code>taaruf-api.donarazhar.site</code></p>
          </div>
        </div>
      </section>

      <!-- Cloudflared Update Section -->
      <section id="cloudflared" class="section">
        <div class="step-header">
          <div class="step-number">1</div>
          <div>
            <h2>Update Cloudflared Config</h2>
            <p class="step-desc">Ubah subdomain dari 2 level ke 1 level</p>
          </div>
        </div>

        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">bash</span>
            <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
          </div>
          <pre><code># Edit config
nano /etc/cloudflared/config.yml

# Ganti hostname
# SEBELUM: api.taaruf.donarazhar.site
# SESUDAH: taaruf-api.donarazhar.site

# Tambah DNS route baru
cloudflared tunnel route dns taaruf taaruf-api.donarazhar.site

# Restart service
systemctl restart cloudflared</code></pre>
        </div>

        <div class="info-card">
          <span class="info-icon">‚ÑπÔ∏è</span>
          <div class="info-content">
            Jangan lupa hapus DNS record lama di Cloudflare Dashboard
          </div>
        </div>
      </section>

      <!-- OAuth Flow Section -->
      <section id="oauth-flow" class="section">
        <div class="step-header">
          <div class="step-number">2</div>
          <div>
            <h2>Google OAuth Flow</h2>
            <p class="step-desc">
              Alur autentikasi Google OAuth dengan redirect ke frontend
            </p>
          </div>
        </div>

        <div class="steps-list">
          <div class="step-item">
            <span class="step-bullet">1</span>
            <span>User klik "Login with Google" di frontend</span>
          </div>
          <div class="step-item">
            <span class="step-bullet">2</span>
            <span>Frontend hit API: <code>GET /api/auth/google</code></span>
          </div>
          <div class="step-item">
            <span class="step-bullet">3</span>
            <span>API return Google OAuth URL</span>
          </div>
          <div class="step-item">
            <span class="step-bullet">4</span>
            <span>User redirect ke Google, login, consent</span>
          </div>
          <div class="step-item">
            <span class="step-bullet">5</span>
            <span
              >Google redirect ke:
              <code
                >taaruf-api.donarazhar.site/api/auth/google/callback</code
              ></span
            >
          </div>
          <div class="step-item">
            <span class="step-bullet">6</span>
            <span
              >API <strong>REDIRECT</strong> ke:
              <code
                >taaruf.donarazhar.site/auth/google/callback?token=...</code
              ></span
            >
          </div>
          <div class="step-item">
            <span class="step-bullet">7</span>
            <span
              >Frontend baca token dari URL, simpan ke localStorage, redirect ke
              Dashboard</span
            >
          </div>
        </div>

        <div class="warning-card" style="margin-top: 1.5rem">
          <span class="warning-icon">‚ö†Ô∏è</span>
          <div class="warning-content">
            <strong>PENTING:</strong> API HARUS redirect ke frontend dengan
            token, BUKAN return JSON langsung!
          </div>
        </div>
      </section>

      <!-- OAuth Setup Section -->
      <section id="oauth-setup" class="section">
        <div class="step-header">
          <div class="step-number">3</div>
          <div>
            <h2>Setup Google Cloud Console</h2>
            <p class="step-desc">
              Konfigurasi OAuth credentials di Google Cloud
            </p>
          </div>
        </div>

        <div class="steps-list">
          <div class="step-item">
            <span class="step-bullet">1</span>
            <span
              >Buka
              <a href="https://console.cloud.google.com" target="_blank"
                >console.cloud.google.com</a
              ></span
            >
          </div>
          <div class="step-item">
            <span class="step-bullet">2</span>
            <span
              >APIs & Services ‚Üí Credentials ‚Üí Create Credentials ‚Üí OAuth client
              ID</span
            >
          </div>
          <div class="step-item">
            <span class="step-bullet">3</span>
            <span>Application type: <strong>Web application</strong></span>
          </div>
        </div>

        <h4 style="margin-top: 1.5rem; color: var(--text-secondary)">
          Authorized JavaScript origins:
        </h4>
        <div class="code-block small">
          <pre><code>https://taaruf.donarazhar.site</code></pre>
        </div>

        <h4 style="margin-top: 1rem; color: var(--text-secondary)">
          Authorized redirect URIs:
        </h4>
        <div class="code-block small">
          <pre><code>https://taaruf-api.donarazhar.site/api/auth/google/callback</code></pre>
        </div>
      </section>

      <!-- Laravel Config Section -->
      <section id="oauth-laravel" class="section">
        <div class="step-header">
          <div class="step-number">4</div>
          <div>
            <h2>Laravel .env Configuration</h2>
            <p class="step-desc">Konfigurasi Google OAuth di Laravel backend</p>
          </div>
        </div>

        <div class="code-block">
          <div class="code-header">
            <span class="code-lang">env</span>
            <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
          </div>
          <pre><code>GOOGLE_CLIENT_ID=xxxxxxxxxxxxx.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=xxxxxxxxxxxxxxxx
GOOGLE_REDIRECT_URI=https://taaruf-api.donarazhar.site/api/auth/google/callback</code></pre>
        </div>

        <div class="code-block" style="margin-top: 1rem">
          <div class="code-header">
            <span class="code-lang">bash</span>
            <button class="copy-btn" onclick="copyCode(this)">üìã Copy</button>
          </div>
          <pre><code># Clear cache setelah update .env
cd /var/www/taaruf/api
php artisan config:clear
php artisan cache:clear</code></pre>
        </div>
      </section>

      <!-- Deployment Steps Section -->
      <section id="deploy-steps" class="section">
        <div class="step-header">
          <div class="step-number">5</div>
          <div>
            <h2>Deployment Steps</h2>
            <p class="step-desc">Langkah-langkah deploy ke server</p>
          </div>
        </div>

        <h4 style="margin-bottom: 0.75rem; color: var(--accent-primary)">
          1. Pull Latest Code
        </h4>
        <div class="code-block small">
          <pre><code>cd /var/www/taaruf
git pull origin main</code></pre>
        </div>

        <h4 style="margin: 1.25rem 0 0.75rem; color: var(--accent-primary)">
          2. Deploy Web Frontend
        </h4>
        <div class="code-block small">
          <pre><code>rm -rf web-dist/*
unzip -o web/dist.zip -d web-dist
grep "taaruf-api" web-dist/assets/*.js | head -1</code></pre>
        </div>

        <h4 style="margin: 1.25rem 0 0.75rem; color: var(--accent-primary)">
          3. Deploy API Backend
        </h4>
        <div class="code-block small">
          <pre><code>cd api
composer install --no-dev --optimize-autoloader
php artisan config:clear
php artisan cache:clear
php artisan route:clear</code></pre>
        </div>

        <h4 style="margin: 1.25rem 0 0.75rem; color: var(--accent-primary)">
          4. Set Permissions
        </h4>
        <div class="code-block small">
          <pre><code>chown -R www-data:www-data /var/www/taaruf
chmod -R 755 /var/www/taaruf
chmod -R 775 /var/www/taaruf/api/storage</code></pre>
        </div>

        <h4 style="margin: 1.25rem 0 0.75rem; color: var(--accent-primary)">
          5. Restart Services
        </h4>
        <div class="code-block small">
          <pre><code>systemctl restart php8.2-fpm nginx cloudflared</code></pre>
        </div>
      </section>

      <!-- Checklist Section -->
      <section id="checklist" class="section">
        <div class="section-header">
          <span class="section-icon">üìã</span>
          <h2>Deployment Checklist</h2>
        </div>

        <div class="steps-list">
          <div class="step-item">
            <span class="step-bullet">‚òê</span> Git pull latest code
          </div>
          <div class="step-item">
            <span class="step-bullet">‚òê</span> Extract web dist.zip ke web-dist/
          </div>
          <div class="step-item">
            <span class="step-bullet">‚òê</span> Composer install di folder api/
          </div>
          <div class="step-item">
            <span class="step-bullet">‚òê</span> Clear Laravel cache
          </div>
          <div class="step-item">
            <span class="step-bullet">‚òê</span> Set file permissions
          </div>
          <div class="step-item">
            <span class="step-bullet">‚òê</span> Restart PHP-FPM, Nginx,
            Cloudflared
          </div>
          <div class="step-item">
            <span class="step-bullet">‚òê</span> Test login email/password
          </div>
          <div class="step-item">
            <span class="step-bullet">‚òê</span> Test login Google OAuth
          </div>
        </div>
      </section>

      <!-- Troubleshooting Section -->
      <section id="troubleshooting" class="section">
        <div class="section-header">
          <span class="section-icon">üîß</span>
          <h2>Troubleshooting</h2>
        </div>

        <div class="trouble-card">
          <h3>‚ùå SSL Error: ERR_SSL_VERSION_OR_CIPHER_MISMATCH</h3>
          <p>
            <strong>Penyebab:</strong> Subdomain 2 level tidak di-cover
            Universal SSL
          </p>
          <p>
            <strong>Solusi:</strong> Rename subdomain ke 1 level (contoh:
            <code>taaruf-api</code> bukan <code>api.taaruf</code>)
          </p>
        </div>

        <div class="trouble-card">
          <h3>‚ùå API Return 500 Error</h3>
          <p><strong>Penyebab:</strong> Route [login] not defined</p>
          <p>
            <strong>Solusi:</strong> Tambah exception handler untuk
            AuthenticationException di <code>bootstrap/app.php</code>
          </p>
        </div>

        <div class="trouble-card">
          <h3>‚ùå Google Login Showing JSON Instead of Dashboard</h3>
          <p><strong>Penyebab:</strong> API return JSON langsung ke browser</p>
          <p>
            <strong>Solusi:</strong> Ubah API agar redirect ke frontend dengan
            token di URL params
          </p>
        </div>

        <div class="trouble-card">
          <h3>‚ùå Web Still Using localhost:8000</h3>
          <p><strong>Penyebab:</strong> Server belum deploy dist.zip baru</p>
          <p>
            <strong>Solusi:</strong>
            <code>rm -rf web-dist/* && unzip -o web/dist.zip -d web-dist</code>
          </p>
        </div>
      </section>

      <!-- URLs Section -->
      <section id="urls" class="section">
        <div class="section-header">
          <span class="section-icon">üìû</span>
          <h2>URLs Aplikasi</h2>
        </div>

        <div class="table-container">
          <table class="command-table">
            <thead>
              <tr>
                <th>Service</th>
                <th>URL</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Web Frontend</td>
                <td>
                  <a href="https://taaruf.donarazhar.site" target="_blank"
                    >https://taaruf.donarazhar.site</a
                  >
                </td>
              </tr>
              <tr>
                <td>API Backend</td>
                <td>
                  <a href="https://taaruf-api.donarazhar.site" target="_blank"
                    >https://taaruf-api.donarazhar.site</a
                  >
                </td>
              </tr>
              <tr>
                <td>API Health Check</td>
                <td>
                  <a
                    href="https://taaruf-api.donarazhar.site/api/user"
                    target="_blank"
                    >https://taaruf-api.donarazhar.site/api/user</a
                  >
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Footer -->
      <footer class="footer">
        <p>Dokumentasi dibuat pada 7 Februari 2026</p>
        <div class="footer-links">
          <a href="index.html">Cloudflare Tunnel Guide</a>
          <span>‚Ä¢</span>
          <a href="deployment-guide.html">Deployment Guide</a>
        </div>
      </footer>
    </main>

    <script>
      function copyCode(btn) {
        const code = btn
          .closest(".code-block")
          .querySelector("code").textContent;
        navigator.clipboard.writeText(code).then(() => {
          const originalText = btn.textContent;
          btn.textContent = "‚úÖ Copied!";
          setTimeout(() => (btn.textContent = originalText), 2000);
        });
      }

      // Scroll spy for navigation
      const sections = document.querySelectorAll("section[id]");
      const navItems = document.querySelectorAll(".nav-item");

      window.addEventListener("scroll", () => {
        let current = "";
        sections.forEach((section) => {
          const sectionTop = section.offsetTop - 100;
          if (scrollY >= sectionTop) {
            current = section.getAttribute("id");
          }
        });

        navItems.forEach((item) => {
          item.classList.remove("active");
          if (item.getAttribute("href") === `#${current}`) {
            item.classList.add("active");
          }
        });
      });
    </script>
  </body>
</html>
